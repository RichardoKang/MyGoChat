syntax = "proto3";
package v1;
option go_package = "MyGoChat/pkg/pb/v1;pb";

import "google/protobuf/any.proto";
import "google/protobuf/timestamp.proto";

message Message {
  string id = 1;                // 消息唯一ID (MongoDB ObjectID)
  string conversationID = 2;   // 会话ID (MongoDB ObjectID)
  string senderUUID = 3;         // 发送消息用户UUID
  int64 timestamp = 4;          // 消息发送时间
  int32 contentType = 5;       // 1=text, 2=image, 3=file, 4=voice
  google.protobuf.Any body = 6; // 消息内容
  MessageMetadata metadata = 7; // 元数据
  google.protobuf.Timestamp deleted_at = 8; // 删除时间

  // The following fields are for client display purposes and are not stored in the database.
  string senderName = 9;      // 发送消息用户的用户名
  string avatar = 10;           // 头像
  int32 messageType = 11;      // 消息类型，1.单聊 2.群聊
}

// TextBody is used for text messages, and it's packed into the 'body' field of the Message.
message TextBody {
    string content = 1;
}


// FileAttachment is used for file/image/voice messages, and it's packed into the 'body' field of the Message.
message FileAttachment {
    string url = 1;       // MinIO/S3 的 URL
    string fileName = 2; // "简历.pdf"
    int64 size = 3;       // 文件大小 (bytes)
    string mimeType = 4; // "image/jpeg"
}

// MessageMetadata 用于存储回复、@ 等元数据
message MessageMetadata {
    string replyToMsgID = 1; // 回复的消息 ID (用 string 存 ObjectID)
}